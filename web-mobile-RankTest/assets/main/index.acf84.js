window.__require=function e(t,a,n){function i(c,r){if(!a[c]){if(!t[c]){var o=c.split("/");if(o=o[o.length-1],!t[o]){var l="function"==typeof __require&&__require;if(!r&&l)return l(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+c+"'")}c=o}var d=a[c]={exports:{}};t[c][0].call(d.exports,function(e){return i(t[c][1][e]||e)},d,d.exports,e,t,a,n)}return a[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<n.length;c++)i(n[c]);return i}({Battle:[function(e,t,a){"use strict";cc._RF.push(t,"f11ccuzoOVLdJ+t8nnV4YAf","Battle");var n=cc.Class({name:"Card",properties:{id:cc.Integer,type:cc.Integer,value:cc.Integer,weight:{default:1,type:cc.Integer},levelImages:[cc.SpriteFrame],skill:cc.Sprite,effect:cc.Sprite,animation:cc.Animation}}),i=cc.Class({name:"DisplayCard",properties:{card:n,level:cc.Integer,value:{get:function(){return this.card.value*this.level}}}});cc.Class({ctor:function(){this.totalTime=0},extends:cc.Component,properties:{stage:cc.Integer,cardFrames:[n],enemyBlood:{default:100,type:cc.Integer},playerDefense:{default:0,type:cc.Integer},playerHitrate:{default:.6,type:cc.Float},playerBlood:{default:50,type:cc.Integer},enemyBloodBar:cc.ProgressBar,playerBloodBar:cc.ProgressBar,activeCards:[cc.Button],handCards:[cc.Button],handCardBlockInputEvents:cc.Node,hitedPicture:cc.Sprite,WinPopupWindow:cc.Sprite,LosePopupWindow:cc.Sprite,EnemyTalk:[cc.Sprite],BackGrounpBGM:cc.AudioSource,missHitPicture:cc.Animation,AttackBgm:cc.AudioClip,DefenseBgm:cc.AudioClip,HealBgm:cc.AudioClip,HitedBgm:cc.AudioClip,Victory:cc.Button},onLoad:function(){var e=this;this.handCardBlockInputEvents.zIndex=999,this._activeCardObjects=[],this._handCardObjects=[],this._currentEnemyBlood=this.enemyBlood,this._currentPlayerBlood=this.playerBlood,this._disableHandCardCount=0,this._isDragging=!1,this.handCards.forEach(function(t,a){e.bindHandCardEvents(t,a)}.bind(this)),this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){var e=this;setInterval(function(){e.totalTime=e.totalTime+1},1e3),this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play(),this.showEnemyTalk();for(var t=0;t<7;t++)this._handCardObjects.push(this.getRandomCard());this.refresh(),cc.tween(this.node).delay(1).call(function(){e.combineHandCards(!0)}).start()},refreshActiveCards:function(){for(var e=0;e<3;e++)this._activeCardObjects[e]?this.activeCards[e]._sprite.spriteFrame=this._activeCardObjects[e].card.levelImages[this._activeCardObjects[e].level-1]:this.activeCards[e]._sprite.spriteFrame=null},refreshHandCards:function(){for(var e=0;e<7;e++)this._handCardObjects[e]?this.handCards[e]._sprite.spriteFrame=this._handCardObjects[e].card.levelImages[this._handCardObjects[e].level-1]:this.handCards[e]._sprite.spriteFrame=null},refreshBlood:function(){this.enemyBloodBar.progress=this._currentEnemyBlood/this.enemyBlood,this.playerBloodBar.progress=this._currentPlayerBlood/this.playerBlood},refresh:function(){this.refreshActiveCards(),this.refreshHandCards(),this.refreshBlood()},getRandom:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getFloorRandom:function(e,t){return(Math.random()*(t-e)+e).toFixed(1)},getNotRepeatRandom:function(){for(var e=[0,1,2,3],t=[],a=0;a<1;a++){var n=Math.floor(Math.random()*e.length);t.push(e.splice(n,1)[0])}return n},getMoveCard:function(){var e=new i;return e.card=this.cardFrames[0],e.level=1,e},getRandomCard:function(){var e=[];this.cardFrames.forEach(function(t){if(t.id>0)for(var a=0;a<t.weight;a++)e.push(t)});var t=this.getRandom(0,e.length-1),a=new i;return a.card=e[t],a.level=1,a},combineHandCards:function(e){var t,a=this;do{var n=null,i=[];t=this._handCardObjects.length;for(var s=0;s<this._handCardObjects.length;s++){var c=!1;n&&(n.card.id==this._handCardObjects[s].card.id&&n.level==this._handCardObjects[s].level&&n.level<n.card.levelImages.length&&(n.level++,c=!0),i.push(n)),n=c?null:this._handCardObjects[s],s==this._handCardObjects.length-1&&n&&i.push(n)}this._handCardObjects=i}while(t!=this._handCardObjects.length);this.refreshHandCards(),e&&this._handCardObjects.length<7&&cc.tween(this.node).call(function(){a.disableHandCards()}).delay(.5).call(function(){a.drawCard()}).call(function(){a.enableHandCards()}).start()},drawCard:function(){for(var e=this,t=0;t<7-this._handCardObjects.length;t++)this._handCardObjects.push(this.getRandomCard());this.refreshHandCards(),cc.tween(this.node).call(function(){e.disableHandCards()}).delay(.5).call(function(){e.combineHandCards(!0)}).call(function(){e.enableHandCards()}).start()},onHandCardClick:function(e,t){var a=this;!this._isDragging&&this._activeCardObjects.length<3?(this._activeCardObjects.push(this._handCardObjects.splice(t,1)[0]),this.refresh(),this.combineHandCards(!1),3==this._activeCardObjects.length&&cc.tween(this.node).delay(1).call(function(){a.onCardAction()}).start()):this._isDragging=!1},onCardMoved:function(e,t){for(var a=this,n=this._handCardObjects.length,i=0;i<this._handCardObjects.length;i++)if(this.handCards[i].node.x+62>=t&&this.handCards[i].node.x<t){n=i;break}if(e!=n&&e!=n-1){var s=this._handCardObjects[e];if(n>e){for(i=e;i<n-1;i++)this._handCardObjects[i]=this._handCardObjects[i+1];this._handCardObjects[n-1]=s}else{for(i=e;i>n;i--)this._handCardObjects[i]=this._handCardObjects[i-1];this._handCardObjects[n]=s}this._activeCardObjects.push(this.getMoveCard()),this.refresh();var c=cc.tween(this.node).call(function(){a.disableHandCards()}).delay(.5).call(function(){a.combineHandCards(!1)});3==this._activeCardObjects.length&&(c=c.delay(1).call(function(){a.onCardAction()})),c.call(function(){a.enableHandCards()}).start()}},onCardAction:function(){var e=this,t=cc.tween(this.node).call(function(){e.disableHandCards()});this.showEnemyTalk();for(var a=0;a<this._activeCardObjects.length;a++)t=t.call(function(){var a=e._activeCardObjects.splice(0,1)[0],n=!1;switch(a.card.type){case 1:n=e.attack(a.value,t);break;case 2:n=e.defense(a.value);break;case 3:n=e.heal(a.value);break;case 4:n=e.uphitrate(a.value)}null!=a.card.skill&&(a.card.skill.node.active=!0),n&&(null!=a.card.effect&&(a.card.effect.node.active=!0),null!=a.card.animation&&(a.card.animation.node.active=!0,a.card.animation.play())),e.refreshActiveCards(),e.refreshBlood()}.bind(this)).delay(1).call(function(){e.initialRound()});t=t.call(function(){e.playerDefense<=10&&(e._currentPlayerBlood-=10-e.playerDefense),cc.audioEngine.play(e.HitedBgm,!1,.5),e.hitedPicture.node.active=!0,e.playerDefense=0,e.playerHitrate=.6,e.showEnemyTalk(),e._currentPlayerBlood<=0&&(e.showLosePopup(),t.stop()),e.refresh()}).delay(1).call(function(){e.hitedPicture.node.active=!1,e.drawCard()}).call(function(){e.enableHandCards()}).start()},initialRound:function(){this.cardFrames.forEach(function(e){null!=e.skill&&(e.skill.node.active=!1),null!=e.effect&&(e.effect.node.active=!1),null!=e.animation&&(e.animation.node.active=!1)}),null!=this.missHitPicture&&(this.missHitPicture.node.active=!1)},bindHandCardEvents:function(e,t){var a,n=this,i=!1;e.node.on(cc.Node.EventType.TOUCH_START,function(t){i=!0,a=e.node.x,e.node.zIndex=100}),e.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(i){var a=t.getDelta(),s=e.node.x+a.x;s>=195&&(s=195),s<=-195&&(s=-195),e.node.x=s,n._isDragging=!0}}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_END,function(s){var c=e.node.x;i=!1,e.node.x=a,e.node.zIndex=0,n._isDragging&&n.onCardMoved(t,c)}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(s){var c=e.node.x;i=!1,e.node.x=a,e.node.zIndex=0,n._isDragging&&n.onCardMoved(t,c)}.bind(this))},enableHandCards:function(){this._disableHandCardCount--,this._disableHandCardCount<=0&&(this._disableHandCardCount=0,this.handCardBlockInputEvents.active=!1)},disableHandCards:function(){this._disableHandCardCount++,this.handCardBlockInputEvents.active=!0},attack:function(e,t){var a=!0;2!=this.stage&&4!=this.stage||(a=!1,this.getFloorRandom(0,1)<=this.playerHitrate&&(a=!0));return a?(this._currentEnemyBlood-=e,cc.audioEngine.play(this.AttackBgm,!1,.5)):(this.missHitPicture.node.active=!0,this.missHitPicture.play()),this._currentEnemyBlood<=0?(this.showWinPopup(),this.winLevelSet(),this.initialRound(),void t.stop()):a},defense:function(e){return this.playerDefense+=e,cc.audioEngine.play(this.DefenseBgm,!1,.5),!0},heal:function(e){return this._currentPlayerBlood+=e,cc.audioEngine.play(this.HealBgm,!1,.5),!0},uphitrate:function(e){return cc.audioEngine.play(this.HealBgm,!1,.5),this.playerHitrate+=e,this.playerHitrate>1&&(this.playerHitrate=1),!0},showWinPopup:function(){this.WinPopupWindow.node.active=!0,cc.tween(this.WinPopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},winLevelSet:function(){this.stage;var e="",t="",a="",n="",i="";cc.loader.load("https://script.google.com/macros/s/AKfycbyadt4KCSecRCnCR8o_3QZSn4UnTxPvyiZ37YwF2L54TxnkSdtP/exec",function(s,c){if(s)cc.log(s);else{var r=JSON.parse(c);for(var o in r.Levelsettings){var l={};r.Levelsettings[o].playerId==cc.sys.localStorage.getItem("PlayerId")&&(l.playerId=r.Levelsettings[o].playerId,l.level1State=r.Levelsettings[o].level1State,l.level2State=r.Levelsettings[o].level2State,l.level3State=r.Levelsettings[o].level3State,l.level4State=r.Levelsettings[o].level4State,l.totalTime=r.Levelsettings[o].totalTime)}if(1==this.stage?(e="level1State",t="level2State",a="level1Time",n="FINISH",i="UNLOCKED","FINISH"==l.level1State&&(n="FINISH",i="FINISH")):2==this.stage?(e="level2State",t="level3State",a="level2Time",n="FINISH",i="UNLOCKED","FINISH"==l.level2State&&(n="FINISH",i="FINISH")):3==this.stage?(e="level3State",t="level4State",a="level3Time",n="FINISH",i="UNLOCKED","FINISH"==l.level3State&&(n="FINISH",i="FINISH")):4==this.stage&&(e="level4State",a="level4Time",n="FINISH",i="UNLOCKED","FINISH"==l.level4State&&(n="FINISH",i="FINISH")),cc.sys.localStorage.getItem("PlayerId")){var d="https://script.google.com/macros/s/AKfycbxPxFT2ASWdLeS9lXP87fGvh5r-_0rC42_qnypuUAbMJk5KE9xA/exec?playerId="+cc.sys.localStorage.getItem("PlayerId")+"&"+e+"="+n+"&"+t+"="+i+"&"+a+"="+this.totalTime;cc.loader.load(d,function(e,t){e?cc.log(e):cc.log("\u7de8\u8f2f\u6210\u529f!:"+d+"totalTime:"+this.totalTime)}.bind(this))}}}.bind(this))},showLosePopup:function(){this.LosePopupWindow.node.active=!0,cc.tween(this.LosePopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},showEnemyTalk:function(){var e=this,t=this.getNotRepeatRandom(),a=cc.tween(this.EnemyTalk);a=a.call(function(){for(var a=0;a<e.EnemyTalk.length;a++)e.EnemyTalk[a].node.active=a==t}).start()},onClickVictory:function(){this.showWinPopup(),this.winLevelSet(),this.initialRound()}}),cc._RF.pop()},{}],ChangeStoryPic:[function(e,t,a){"use strict";cc._RF.push(t,"c08d23yc4NGxLCETjdFsDyY","ChangeStoryPic"),cc.Class({extends:cc.Component,ctor:function(){this._storyFrameIndex=1},properties:{storyNode:cc.Node,nextButtonNode:cc.Node,storyFrames:[cc.SpriteFrame]},onNext:function(){var e=this.storyNode.getComponent(cc.Sprite);this._storyFrameIndex>this.storyFrames.length-1?this._storyFrameIndex=this._storyFrameIndex:this._storyFrameIndex=this._storyFrameIndex+1,e.spriteFrame=this.storyFrames[this._storyFrameIndex],this._storyFrameIndex>=this.storyFrames.length-1&&(this.nextButtonNode.active=!1,this._storyFrameIndex=0)},onload:function(){this._storyFrameIndex=0,this.storyNode.getComponent(cc.Sprite).spriteFrame=this.storyFrames[this._storyFrameIndex],this.nextButtonNode.active=!0}}),cc._RF.pop()},{}],ClearLocalStorage:[function(e,t,a){"use strict";cc._RF.push(t,"696a2flND5KzrZuUSiwYqVO","ClearLocalStorage"),cc.Class({extends:cc.Component,properties:{},clearLocalstorage:function(){cc.sys.localStorage.clear()},start:function(){}}),cc._RF.pop()},{}],LevelSetting:[function(e,t,a){"use strict";cc._RF.push(t,"9bdf84bTbNDYrVdCJseT/Kr","LevelSetting"),a.__esModule=!0,a.Levelsettings=void 0;a.Levelsettings=[{level:1,levelState:"UNLOCKED",sceneName:"battle"},{level:2,levelState:"LOCKED",sceneName:"battle2"},{level:3,levelState:"LOCKED",sceneName:"battle3"},{level:4,levelState:"LOCKED",sceneName:"battle4"},{level:5,levelState:"LOCKED",sceneName:"battle5"}],cc._RF.pop()},{}],LoadingProgressBar:[function(e,t,a){"use strict";cc._RF.push(t,"8cbcdNbt1pEEZeD2QZ8+er8","LoadingProgressBar"),cc.Class({extends:cc.Component,properties:{progress:cc.ProgressBar,text:cc.Label},start:function(){var e=this,t=cc.sys.localStorage.getItem("levelSceneName");this.text.string="0%",this.progress.progress=0,cc.director.preloadScene(t,function(t,a,n){var i=t/a;e.progress.progress=i,e.text.string=parseInt(100*i)+"%",console.log(e.text.string)},function(){cc.director.loadScene(t)})}}),cc._RF.pop()},{}],MusicLoop:[function(e,t,a){"use strict";cc._RF.push(t,"87407BkzlRH0p7POYV6E84Y","MusicLoop"),cc.Class({extends:cc.Component,properties:{BackGrounpBGM:cc.AudioSource},onLoad:function(){this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play()}}),cc._RF.pop()},{}],PopupWindow:[function(e,t,a){"use strict";cc._RF.push(t,"be07ady7wRFWpP+zOcFY/xn","PopupWindow"),cc.Class({extends:cc.Component,ctor:function(){},properties:{},Show_Window:function(){this.node.active=!0},Hide_Window:function(){this.node.active=!1},Next_Click:function(){},Exit_Click:function(){this.Hide_Window()}}),cc._RF.pop()},{}],SceneFacade:[function(e,t,a){"use strict";cc._RF.push(t,"d92be3+8lBCKZdLU76R9P66","SceneFacade"),cc.Class({extends:cc.Component,properties:{},start:function(){},loadScene:function(e,t){cc.director.loadScene(t)},loadLevelScene:function(e,t){cc.sys.localStorage.setItem("levelSceneName",t)},reloadSecen:function(){cc.director.loadScene(cc.sys.localStorage.getItem("levelSceneName"))}}),cc._RF.pop()},{}],SelectLevel:[function(e,t,a){"use strict";cc._RF.push(t,"bd7d6fbqdNOVaGlu0p7jcTH","SelectLevel");var n=e("./LevelSetting.js");cc.Class({extends:cc.Component,properties:{level:[cc.Node],unlockPic:[cc.SpriteFrame],lockPic:[cc.SpriteFrame],finishPic:[cc.SpriteFrame],CheakPoint_BlockInputEvent:[cc.Node],PlayerId:cc.Label},onLoad:function(){this.CheakPoint_BlockInputEvent.zIndex=999;var e=[];if(cc.sys.localStorage.getItem("PlayerId")){var t="https://script.google.com/macros/s/AKfycbyadt4KCSecRCnCR8o_3QZSn4UnTxPvyiZ37YwF2L54TxnkSdtP/exec";this.PlayerId.string="Id: "+cc.sys.localStorage.getItem("PlayerId"),cc.loader.load(t,function(t,a){if(t)cc.log(t);else{var n=JSON.parse(a);for(var i in n.Levelsettings){var s={};n.Levelsettings[i].playerId==cc.sys.localStorage.getItem("PlayerId")&&(s.playerId=n.Levelsettings[i].playerId,s.level1State=n.Levelsettings[i].level1State,s.level2State=n.Levelsettings[i].level2State,s.level3State=n.Levelsettings[i].level3State,s.level4State=n.Levelsettings[i].level4State,s.totalTime=n.Levelsettings[i].totalTime,e.push(s))}console.table(e),this.initLevels(e)}}.bind(this))}else{var a=Math.floor(1e3*Math.random())+1,n=Math.floor(10*Math.random())+1;this.PlayerId.string="Id: "+a+"_"+n;t="https://script.google.com/macros/s/AKfycbzt-4nEdfCPfAB4wx0gc7gBfAjrVxqynruFZRHZc0kdY6sGwCLW/exec?playerId="+a+"_"+n;cc.loader.load(t,function(e,t){e?cc.log(e):(cc.sys.localStorage.setItem("PlayerId",a+"_"+n),cc.log("\u6210\u529f!"))}.bind(this))}},initLevels:function(e){if(e){var t=e;for(a=0;a<4;a++)this.InitLevelPic(t[0].level1State,a++),this.InitLevelPic(t[0].level2State,a++),this.InitLevelPic(t[0].level3State,a++),this.InitLevelPic(t[0].level4State,a++)}else{for(var a=0;a<e.length;a++)this.level[a].items=e[a],this.InitLevelPic(this.level[a].items.levelState,a);cc.sys.localStorage.setItem("Levelsettings",JSON.stringify(n.Levelsettings))}},InitLevelPic:function(e,t){"UNLOCKED"==e?(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.unlockPic[t],this.level[t].children[1].active=!1):"LOCKED"==e?(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.lockPic[t],this.level[t].children[1].active=!0):"FINISH"==e&&(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.finishPic[t],this.level[t].children[1].active=!1,3==t&&(this.level[t+1].active=!0))},start:function(){}}),cc._RF.pop()},{"./LevelSetting.js":"LevelSetting"}],ShowRank:[function(e,t,a){"use strict";cc._RF.push(t,"e1cadTuoz5BaaFx+B/JtW6P","ShowRank"),cc.Class({extends:cc.Component,properties:{RankPlayerLabel:[cc.Label],RankPlayertotalLevel:[cc.Label],RankPlayerTotalTime:[cc.Label]},start:function(){},onLoad:function(){this.getRanks()},getRanks:function(){var e=[];cc.loader.load("https://script.google.com/macros/s/AKfycbyadt4KCSecRCnCR8o_3QZSn4UnTxPvyiZ37YwF2L54TxnkSdtP/exec",function(t,a){if(t)cc.log(t);else{for(var n=JSON.parse(a),i=0;i<n.Levelsettings.length;i++){var s={};s.playerId=n.Levelsettings[i].playerId,s.level1State=n.Levelsettings[i].level1State,s.level2State=n.Levelsettings[i].level2State,s.level3State=n.Levelsettings[i].level3State,s.level4State=n.Levelsettings[i].level4State,s.totalTime=n.Levelsettings[i].totalTime,s.passLevelTotalNumber=n.Levelsettings[i].passLevelTotalNumber,e.push(s)}console.table(e),this.Compare(e)}}.bind(this))},Compare:function(e){for(var t=0;t<e.length;t++)for(var a=0;a<e.length-1-t;a++){if(e[a].passLevelTotalNumber<e[a+1].passLevelTotalNumber){var n=e[a];e[a]=e[a+1],e[a+1]=n}if(e[a].passLevelTotalNumber==e[a+1].passLevelTotalNumber&&e[a].totalTime>e[a+1].totalTime){n=e[a];e[a]=e[a+1],e[a+1]=n}}this.ShowLabel(e)},ShowLabel:function(e){for(var t=0;t<8;t++)this.RankPlayerLabel[t].string=e[t].playerId,this.RankPlayertotalLevel[t].string=e[t].passLevelTotalNumber,this.RankPlayerTotalTime[t].string=e[t].totalTime}}),cc._RF.pop()},{}],SpriteIndex:[function(e,t,a){"use strict";cc._RF.push(t,"24dacw8QS1Kpr0ZBSQEQOkx","SpriteIndex"),cc.Class({extends:cc.Component,properties:{_index:20,spr:{default:[],type:cc.SpriteFrame},bar:{get:function(){return this._index},set:function(e){e<0||(this._index=e%spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])}}},onLoad:function(){var e=this;this.schedule(function(){e._index++},3)},onTouchChange:function(){this._index++}}),cc._RF.pop()},{}]},{},["Battle","ChangeStoryPic","ClearLocalStorage","LevelSetting","LoadingProgressBar","MusicLoop","PopupWindow","SceneFacade","SelectLevel","ShowRank","SpriteIndex"]);