window.__require=function e(t,n,i){function a(s,r){if(!n[s]){if(!t[s]){var o=s.split("/");if(o=o[o.length-1],!t[o]){var d="function"==typeof __require&&__require;if(!r&&d)return d(o,!0);if(c)return c(o,!0);throw new Error("Cannot find module '"+s+"'")}s=o}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return a(t[s][1][e]||e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<i.length;s++)a(i[s]);return a}({Battle:[function(e,t,n){"use strict";cc._RF.push(t,"f11ccuzoOVLdJ+t8nnV4YAf","Battle");var i=cc.Class({name:"Card",properties:{id:cc.Integer,type:cc.Integer,value:cc.Integer,weight:{default:1,type:cc.Integer},levelImages:[cc.SpriteFrame],skill:cc.Sprite,effect:cc.Sprite,animation:cc.Animation}}),a=cc.Class({name:"DisplayCard",properties:{card:i,level:cc.Integer,value:{get:function(){return this.card.value*this.level}}}});cc.Class({extends:cc.Component,properties:{stage:cc.Integer,cardFrames:[i],enemyBlood:{default:100,type:cc.Integer},playerDefense:{default:0,type:cc.Integer},playerHitrate:{default:.6,type:cc.Float},playerBlood:{default:50,type:cc.Integer},enemyBloodBar:cc.ProgressBar,playerBloodBar:cc.ProgressBar,activeCards:[cc.Button],handCards:[cc.Button],handCardBlockInputEvents:cc.Node,hitedPicture:cc.Sprite,WinPopupWindow:cc.Sprite,LosePopupWindow:cc.Sprite,EnemyTalk:[cc.Sprite],BackGrounpBGM:cc.AudioSource,missHitPicture:cc.Animation,AttackBgm:cc.AudioClip,DefenseBgm:cc.AudioClip,HealBgm:cc.AudioClip,HitedBgm:cc.AudioClip,Victory:cc.Button},onLoad:function(){var e=this;this.handCardBlockInputEvents.zIndex=999,this._activeCardObjects=[],this._handCardObjects=[],this._currentEnemyBlood=this.enemyBlood,this._currentPlayerBlood=this.playerBlood,this._disableHandCardCount=0,this._isDragging=!1,this.handCards.forEach(function(t,n){e.bindHandCardEvents(t,n)}.bind(this)),this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){var e=this;this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play(),this.showEnemyTalk();for(var t=0;t<7;t++)this._handCardObjects.push(this.getRandomCard());this.refresh(),cc.tween(this.node).delay(1).call(function(){e.combineHandCards(!0)}).start()},refreshActiveCards:function(){for(var e=0;e<3;e++)this._activeCardObjects[e]?this.activeCards[e]._sprite.spriteFrame=this._activeCardObjects[e].card.levelImages[this._activeCardObjects[e].level-1]:this.activeCards[e]._sprite.spriteFrame=null},refreshHandCards:function(){for(var e=0;e<7;e++)this._handCardObjects[e]?this.handCards[e]._sprite.spriteFrame=this._handCardObjects[e].card.levelImages[this._handCardObjects[e].level-1]:this.handCards[e]._sprite.spriteFrame=null},refreshBlood:function(){this.enemyBloodBar.progress=this._currentEnemyBlood/this.enemyBlood,this.playerBloodBar.progress=this._currentPlayerBlood/this.playerBlood},refresh:function(){this.refreshActiveCards(),this.refreshHandCards(),this.refreshBlood()},getRandom:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getFloorRandom:function(e,t){return(Math.random()*(t-e)+e).toFixed(1)},getNotRepeatRandom:function(){for(var e=[0,1,2,3],t=[],n=0;n<1;n++){var i=Math.floor(Math.random()*e.length);t.push(e.splice(i,1)[0])}return i},getMoveCard:function(){var e=new a;return e.card=this.cardFrames[0],e.level=1,e},getRandomCard:function(){var e=[];this.cardFrames.forEach(function(t){if(t.id>0)for(var n=0;n<t.weight;n++)e.push(t)});var t=this.getRandom(0,e.length-1),n=new a;return n.card=e[t],n.level=1,n},combineHandCards:function(e){var t,n=this;do{var i=null,a=[];t=this._handCardObjects.length;for(var c=0;c<this._handCardObjects.length;c++){var s=!1;i&&(i.card.id==this._handCardObjects[c].card.id&&i.level==this._handCardObjects[c].level&&i.level<i.card.levelImages.length&&(i.level++,s=!0),a.push(i)),i=s?null:this._handCardObjects[c],c==this._handCardObjects.length-1&&i&&a.push(i)}this._handCardObjects=a}while(t!=this._handCardObjects.length);this.refreshHandCards(),e&&this._handCardObjects.length<7&&cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.drawCard()}).call(function(){n.enableHandCards()}).start()},drawCard:function(){for(var e=this,t=0;t<7-this._handCardObjects.length;t++)this._handCardObjects.push(this.getRandomCard());this.refreshHandCards(),cc.tween(this.node).call(function(){e.disableHandCards()}).delay(.5).call(function(){e.combineHandCards(!0)}).call(function(){e.enableHandCards()}).start()},onHandCardClick:function(e,t){var n=this;!this._isDragging&&this._activeCardObjects.length<3?(this._activeCardObjects.push(this._handCardObjects.splice(t,1)[0]),this.refresh(),this.combineHandCards(!1),3==this._activeCardObjects.length&&cc.tween(this.node).delay(1).call(function(){n.onCardAction()}).start()):this._isDragging=!1},onCardMoved:function(e,t){for(var n=this,i=this._handCardObjects.length,a=0;a<this._handCardObjects.length;a++)if(this.handCards[a].node.x+62>=t&&this.handCards[a].node.x<t){i=a;break}if(e!=i&&e!=i-1){var c=this._handCardObjects[e];if(i>e){for(a=e;a<i-1;a++)this._handCardObjects[a]=this._handCardObjects[a+1];this._handCardObjects[i-1]=c}else{for(a=e;a>i;a--)this._handCardObjects[a]=this._handCardObjects[a-1];this._handCardObjects[i]=c}this._activeCardObjects.push(this.getMoveCard()),this.refresh();var s=cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.combineHandCards(!1)});3==this._activeCardObjects.length&&(s=s.delay(1).call(function(){n.onCardAction()})),s.call(function(){n.enableHandCards()}).start()}},onCardAction:function(){var e=this,t=cc.tween(this.node).call(function(){e.disableHandCards()});this.showEnemyTalk();for(var n=0;n<this._activeCardObjects.length;n++)t=t.call(function(){var n=e._activeCardObjects.splice(0,1)[0],i=!1;switch(n.card.type){case 1:i=e.attack(n.value,t);break;case 2:i=e.defense(n.value);break;case 3:i=e.heal(n.value);break;case 4:i=e.uphitrate(n.value)}null!=n.card.skill&&(n.card.skill.node.active=!0),i&&(null!=n.card.effect&&(n.card.effect.node.active=!0),null!=n.card.animation&&(n.card.animation.node.active=!0,n.card.animation.play())),e.refreshActiveCards(),e.refreshBlood()}.bind(this)).delay(1).call(function(){e.initialRound()});t=t.call(function(){e.playerDefense<=10&&(e._currentPlayerBlood-=10-e.playerDefense),cc.audioEngine.play(e.HitedBgm,!1,.5),e.hitedPicture.node.active=!0,e.playerDefense=0,e.playerHitrate=.6,e.showEnemyTalk(),e._currentPlayerBlood<=0&&(e.showLosePopup(),t.stop()),e.refresh()}).delay(1).call(function(){e.hitedPicture.node.active=!1,e.drawCard()}).call(function(){e.enableHandCards()}).start()},initialRound:function(){this.cardFrames.forEach(function(e){null!=e.skill&&(e.skill.node.active=!1),null!=e.effect&&(e.effect.node.active=!1),null!=e.animation&&(e.animation.node.active=!1)}),null!=this.missHitPicture&&(this.missHitPicture.node.active=!1)},bindHandCardEvents:function(e,t){var n,i=this,a=!1;e.node.on(cc.Node.EventType.TOUCH_START,function(t){a=!0,n=e.node.x,e.node.zIndex=100}),e.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(a){var n=t.getDelta(),c=e.node.x+n.x;c>=195&&(c=195),c<=-195&&(c=-195),e.node.x=c,i._isDragging=!0}}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_END,function(c){var s=e.node.x;a=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,s)}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(c){var s=e.node.x;a=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,s)}.bind(this))},enableHandCards:function(){this._disableHandCardCount--,this._disableHandCardCount<=0&&(this._disableHandCardCount=0,this.handCardBlockInputEvents.active=!1)},disableHandCards:function(){this._disableHandCardCount++,this.handCardBlockInputEvents.active=!0},attack:function(e,t){var n=!1;2!=this.stage&&4!=this.stage||this.getFloorRandom(0,1)<=this.playerHitrate&&(n=!0);return n?(this._currentEnemyBlood-=e,cc.audioEngine.play(this.AttackBgm,!1,.5)):(this.missHitPicture.node.active=!0,this.missHitPicture.play()),this._currentEnemyBlood<=0?(this.showWinPopup(),this.winLevelSet(),this.initialRound(),void t.stop()):n},defense:function(e){return this.playerDefense+=e,cc.audioEngine.play(this.DefenseBgm,!1,.5),!0},heal:function(e){return this._currentPlayerBlood+=e,cc.audioEngine.play(this.HealBgm,!1,.5),!0},uphitrate:function(e){return cc.audioEngine.play(this.HealBgm,!1,.5),this.playerHitrate+=e,this.playerHitrate>1&&(this.playerHitrate=1),!0},showWinPopup:function(){this.WinPopupWindow.node.active=!0,cc.tween(this.WinPopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},winLevelSet:function(){var e=this.stage-1,t=JSON.parse(cc.sys.localStorage.getItem("Levelsettings"));e>=3?(t[e].levelState="FINISH",t[e+1].levelState="FINISH"):"FINISH"!=t[e].levelState&&(t[e+1].levelState="UNLOCKED",t[e].levelState="FINISH"),cc.sys.localStorage.setItem("Levelsettings",JSON.stringify(t))},showLosePopup:function(){this.LosePopupWindow.node.active=!0,cc.tween(this.LosePopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},showEnemyTalk:function(){var e=this,t=this.getNotRepeatRandom(),n=cc.tween(this.EnemyTalk);n=n.call(function(){for(var n=0;n<e.EnemyTalk.length;n++)e.EnemyTalk[n].node.active=n==t}).start()},onClickVictory:function(){this.showWinPopup(),this.winLevelSet(),this.initialRound()}}),cc._RF.pop()},{}],ChangeStoryPic:[function(e,t,n){"use strict";cc._RF.push(t,"c08d23yc4NGxLCETjdFsDyY","ChangeStoryPic"),cc.Class({extends:cc.Component,ctor:function(){this._storyFrameIndex=1},properties:{storyNode:cc.Node,nextButtonNode:cc.Node,storyFrames:[cc.SpriteFrame]},onNext:function(){var e=this.storyNode.getComponent(cc.Sprite);this._storyFrameIndex>this.storyFrames.length-1?this._storyFrameIndex=this._storyFrameIndex:this._storyFrameIndex=this._storyFrameIndex+1,e.spriteFrame=this.storyFrames[this._storyFrameIndex],this._storyFrameIndex>=this.storyFrames.length-1&&(this.nextButtonNode.active=!1,this._storyFrameIndex=0)},onload:function(){this._storyFrameIndex=0,this.storyNode.getComponent(cc.Sprite).spriteFrame=this.storyFrames[this._storyFrameIndex],this.nextButtonNode.active=!0}}),cc._RF.pop()},{}],ClearLocalStorage:[function(e,t,n){"use strict";cc._RF.push(t,"696a2flND5KzrZuUSiwYqVO","ClearLocalStorage"),cc.Class({extends:cc.Component,properties:{},clearLocalstorage:function(){cc.sys.localStorage.clear()},start:function(){}}),cc._RF.pop()},{}],LevelSetting:[function(e,t,n){"use strict";cc._RF.push(t,"9bdf84bTbNDYrVdCJseT/Kr","LevelSetting"),n.__esModule=!0,n.Levelsettings=void 0;n.Levelsettings=[{level:1,levelState:"UNLOCKED",sceneName:"battle"},{level:2,levelState:"LOCKED",sceneName:"battle2"},{level:3,levelState:"LOCKED",sceneName:"battle3"},{level:4,levelState:"LOCKED",sceneName:"battle4"},{level:5,levelState:"LOCKED",sceneName:"battle5"}],cc._RF.pop()},{}],LoadingProgressBar:[function(e,t,n){"use strict";cc._RF.push(t,"8cbcdNbt1pEEZeD2QZ8+er8","LoadingProgressBar"),cc.Class({extends:cc.Component,properties:{progress:cc.ProgressBar,text:cc.Label},start:function(){var e=this,t=cc.sys.localStorage.getItem("levelSceneName");this.text.string="0%",this.progress.progress=0,cc.director.preloadScene(t,function(t,n,i){var a=t/n;e.progress.progress=a,e.text.string=parseInt(100*a)+"%",console.log(e.text.string)},function(){cc.director.loadScene(t)})}}),cc._RF.pop()},{}],MusicLoop:[function(e,t,n){"use strict";cc._RF.push(t,"87407BkzlRH0p7POYV6E84Y","MusicLoop"),cc.Class({extends:cc.Component,properties:{BackGrounpBGM:cc.AudioSource},onLoad:function(){this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play()}}),cc._RF.pop()},{}],PopupWindow:[function(e,t,n){"use strict";cc._RF.push(t,"be07ady7wRFWpP+zOcFY/xn","PopupWindow"),cc.Class({extends:cc.Component,ctor:function(){},properties:{},Show_Window:function(){this.node.active=!0},Hide_Window:function(){this.node.active=!1},Next_Click:function(){},Exit_Click:function(){this.Hide_Window()}}),cc._RF.pop()},{}],SceneFacade:[function(e,t,n){"use strict";cc._RF.push(t,"d92be3+8lBCKZdLU76R9P66","SceneFacade"),cc.Class({extends:cc.Component,properties:{},start:function(){},loadScene:function(e,t){cc.director.loadScene(t)},loadLevelScene:function(e,t){cc.sys.localStorage.setItem("levelSceneName",t)},reloadSecen:function(){cc.director.loadScene(cc.sys.localStorage.getItem("levelSceneName"))}}),cc._RF.pop()},{}],SelectLevel:[function(e,t,n){"use strict";cc._RF.push(t,"bd7d6fbqdNOVaGlu0p7jcTH","SelectLevel");var i=e("./LevelSetting.js");cc.Class({extends:cc.Component,properties:{level:[cc.Node],unlockPic:[cc.SpriteFrame],lockPic:[cc.SpriteFrame],finishPic:[cc.SpriteFrame],CheakPoint_BlockInputEvent:[cc.Node]},onLoad:function(){this.CheakPoint_BlockInputEvent.zIndex=999,this.initLevels()},initLevels:function(){if(cc.sys.localStorage.getItem("Levelsettings")){var e=JSON.parse(cc.sys.localStorage.getItem("Levelsettings"));for(t=0;t<e.length;t++)this.level[t].Levelsettings=e[t],this.InitLevelPic(this.level[t].Levelsettings.levelState,t)}else{for(var t=0;t<i.Levelsettings.length;t++)this.level[t].Levelsettings=i.Levelsettings[t],this.InitLevelPic(this.level[t].Levelsettings.levelState,t);cc.sys.localStorage.setItem("Levelsettings",JSON.stringify(i.Levelsettings))}},InitLevelPic:function(e,t){"UNLOCKED"==e?(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.unlockPic[t],this.level[t].children[1].active=!1):"LOCKED"==e?(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.lockPic[t],this.level[t].children[1].active=!0):"FINISH"==e&&(this.level[t].children[0].getComponent(cc.Sprite).spriteFrame=this.finishPic[t],this.level[t].children[1].active=!1,4==t&&(this.level[t].active=!0))},start:function(){}}),cc._RF.pop()},{"./LevelSetting.js":"LevelSetting"}],SpriteIndex:[function(e,t,n){"use strict";cc._RF.push(t,"24dacw8QS1Kpr0ZBSQEQOkx","SpriteIndex"),cc.Class({extends:cc.Component,properties:{_index:20,spr:{default:[],type:cc.SpriteFrame},bar:{get:function(){return this._index},set:function(e){e<0||(this._index=e%spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])}}},onLoad:function(){var e=this;this.schedule(function(){e._index++},3)},onTouchChange:function(){this._index++}}),cc._RF.pop()},{}]},{},["Battle","ChangeStoryPic","ClearLocalStorage","LevelSetting","LoadingProgressBar","MusicLoop","PopupWindow","SceneFacade","SelectLevel","SpriteIndex"]);