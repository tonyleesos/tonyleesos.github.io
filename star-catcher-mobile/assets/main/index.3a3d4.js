window.__require=function e(t,n,i){function a(r,c){if(!n[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var d="function"==typeof __require&&__require;if(!c&&d)return d(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var h=n[r]={exports:{}};t[r][0].call(h.exports,function(e){return a(t[r][1][e]||e)},h,h.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<i.length;r++)a(i[r]);return a}({Battle:[function(e,t,n){"use strict";cc._RF.push(t,"f11ccuzoOVLdJ+t8nnV4YAf","Battle");var i=cc.Class({name:"Card",properties:{id:cc.Integer,type:cc.Integer,level:cc.Integer,value:cc.Integer,realValue:{get:function(){return this.value*this.level}}}});cc.Class({extends:cc.Component,properties:{cardFrames:[cc.SpriteFrame],enemyBlood:{default:100,type:cc.Integer},playerDefense:{default:0,type:cc.Integer},playerBlood:{default:50,type:cc.Integer},enemyBloodBar:cc.ProgressBar,playerBloodBar:cc.ProgressBar,activeCards:[cc.Button],handCards:[cc.Button],handCardBlockInputEvents:cc.Node,hitPicture:cc.Sprite,hitedPicture:cc.Sprite,WinPopupWindow:cc.Sprite,LosePopupWindow:cc.Sprite,BackGrounpBGM:cc.AudioSource,HealAnimation:cc.Animation,DefenseAnimation:cc.Animation,DefenseIcon:cc.Sprite,AttackView:cc.Sprite,DefenseView:cc.Sprite,HealView:cc.Sprite,AttackBgm:cc.AudioClip,DefenseBgm:cc.AudioClip,HealBgm:cc.AudioClip,HitedBgm:cc.AudioClip},onLoad:function(){var e=this;this.handCardBlockInputEvents.zIndex=999,this._activeCardObjects=[],this._handCardObjects=[],this._currentEnemyBlood=this.enemyBlood,this._currentPlayerBlood=this.playerBlood,this._disableHandCardCount=0,this._isDragging=!1,this.handCards.forEach(function(t,n){e.bindHandCardEvents(t,n)}.bind(this)),this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){var e=this;this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play();for(var t=0;t<7;t++)this._handCardObjects.push(this.getRandomCard());this.refresh(),cc.tween(this.node).delay(1).call(function(){e.combineHandCards(!0)}).start()},refreshActiveCards:function(){for(var e=0;e<3;e++)if(this._activeCardObjects[e]){var t=0==this._activeCardObjects[e].type?0:3*(this._activeCardObjects[e].type-1)+this._activeCardObjects[e].level;this.activeCards[e]._sprite.spriteFrame=this.cardFrames[t]}else this.activeCards[e]._sprite.spriteFrame=null},refreshHandCards:function(){for(var e=0;e<7;e++)if(this._handCardObjects[e]){var t=0==this._handCardObjects[e].type?0:3*(this._handCardObjects[e].type-1)+this._handCardObjects[e].level;this.handCards[e]._sprite.spriteFrame=this.cardFrames[t]}else this.handCards[e]._sprite.spriteFrame=null},refreshBlood:function(){this.enemyBloodBar.progress=this._currentEnemyBlood/this.enemyBlood,this.playerBloodBar.progress=this._currentPlayerBlood/this.playerBlood},refresh:function(){this.refreshActiveCards(),this.refreshHandCards(),this.refreshBlood()},getRandom:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getRandomCard:function(){var e=this.getRandom(1,3),t=new i;switch(t.id=e,t.level=1,e){case 1:t.type=1,t.value=10;break;case 2:t.type=2,t.value=2;break;case 3:t.type=3,t.value=2}return t},getMoveCard:function(){var e=new i;return e.id=0,e.level=0,e.type=0,e.value=0,e},combineHandCards:function(e){var t,n=this;do{var a=null,o=[];t=this._handCardObjects.length;for(var r=0;r<this._handCardObjects.length;r++){var c=!1;if(a){var s=new i;s.id=a.id,s.type=a.type,s.value=a.value,a.type==this._handCardObjects[r].type&&a.level==this._handCardObjects[r].level&&a.level<3?(s.level=a.level+1,c=!0):s.level=a.level,o.push(s)}a=c?null:this._handCardObjects[r],r==this._handCardObjects.length-1&&a&&o.push(a)}this._handCardObjects=o}while(t!=this._handCardObjects.length);this.refreshHandCards(),e&&this._handCardObjects.length<7&&cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.drawCard()}).call(function(){n.enableHandCards()}).start()},drawCard:function(){for(var e=this,t=0;t<7-this._handCardObjects.length;t++)this._handCardObjects.push(this.getRandomCard());this.refreshHandCards(),cc.tween(this.node).call(function(){e.disableHandCards()}).delay(.5).call(function(){e.combineHandCards(!0)}).call(function(){e.enableHandCards()}).start()},onHandCardClick:function(e,t){var n=this;!this._isDragging&&this._activeCardObjects.length<3?(this._activeCardObjects.push(this._handCardObjects.splice(t,1)[0]),this.refresh(),this.combineHandCards(!1),3==this._activeCardObjects.length&&cc.tween(this.node).delay(1).call(function(){n.onCardAction()}).start()):this._isDragging=!1},onCardMoved:function(e,t){for(var n=this,i=this._handCardObjects.length,a=0;a<this._handCardObjects.length;a++)if(this.handCards[a].node.x+62>=t&&this.handCards[a].node.x<t){i=a;break}if(e!=i&&e!=i-1){var o=this._handCardObjects[e];if(i>e){for(a=e;a<i-1;a++)this._handCardObjects[a]=this._handCardObjects[a+1];this._handCardObjects[i-1]=o}else{for(a=e;a>i;a--)this._handCardObjects[a]=this._handCardObjects[a-1];this._handCardObjects[i]=o}this._activeCardObjects.push(this.getMoveCard()),this.refresh();var r=cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.combineHandCards(!1)});3==this._activeCardObjects.length&&(r=r.delay(1).call(function(){n.onCardAction()})),r.call(function(){n.enableHandCards()}).start()}},onCardAction:function(){for(var e=this,t=cc.tween(this.node).call(function(){e.disableHandCards()}),n=0;n<this._activeCardObjects.length;n++)t=t.call(function(){var n=e._activeCardObjects.splice(0,1)[0];switch(n.type){case 1:e.attack(n.realValue,t);break;case 2:e.defense(n.realValue);break;case 3:e.heal(n.realValue)}e.refreshActiveCards(),e.refreshBlood()}).delay(1).call(function(){e.initialRound()});t=t.call(function(){e.playerDefense<=10&&(e._currentPlayerBlood-=10-e.playerDefense),cc.audioEngine.play(e.HitedBgm,!1,.5),e.hitedPicture.node.active=!0,e.playerDefense=0,e._currentPlayerBlood<=0&&(e.showLosePopup(),t.stop()),e.refresh()}).delay(1).call(function(){e.hitedPicture.node.active=!1,e.drawCard()}).call(function(){e.enableHandCards()}).start()},initialRound:function(){this.hitPicture.node.active=!1,this.AttackView.node.active=!1,this.DefenseView.node.active=!1,this.DefenseIcon.node.active=!1,this.HealView.node.active=!1,this.HealAnimation.node.active=!1},bindHandCardEvents:function(e,t){var n,i=this,a=!1;e.node.on(cc.Node.EventType.TOUCH_START,function(t){a=!0,n=e.node.x,e.node.zIndex=100}),e.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(a){var n=t.getDelta(),o=e.node.x+n.x;o>=195&&(o=195),o<=-195&&(o=-195),e.node.x=o,i._isDragging=!0}}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_END,function(o){var r=e.node.x;a=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,r)}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(o){var r=e.node.x;a=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,r)}.bind(this))},enableHandCards:function(){this._disableHandCardCount--,this._disableHandCardCount<=0&&(this._disableHandCardCount=0,this.handCardBlockInputEvents.active=!1)},disableHandCards:function(){this._disableHandCardCount++,this.handCardBlockInputEvents.active=!0},attack:function(e,t){if(this._currentEnemyBlood-=e,cc.audioEngine.play(this.AttackBgm,!1,.5),this._currentEnemyBlood<=0)return this.showWinPopup(),void t.stop();this.AttackView.node.active=!0,this.hitPicture.node.active=!0},defense:function(e){this.playerDefense+=e,this.DefenseView.node.active=!0,this.DefenseIcon.node.active=!0,this.DefenseAnimation.play(),cc.audioEngine.play(this.DefenseBgm,!1,.5)},heal:function(e){this._currentPlayerBlood+=e,this.HealView.node.active=!0,this.HealAnimation.node.active=!0,this.HealAnimation.play(),cc.audioEngine.play(this.HealBgm,!1,.5)},showWinPopup:function(){this.WinPopupWindow.node.active=!0,cc.tween(this.WinPopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},showLosePopup:function(){this.LosePopupWindow.node.active=!0,cc.tween(this.LosePopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()}}),cc._RF.pop()},{}],ChangeStoryPic:[function(e,t,n){"use strict";cc._RF.push(t,"c08d23yc4NGxLCETjdFsDyY","ChangeStoryPic"),cc.Class({extends:cc.Component,ctor:function(){this._storyFrameIndex=1},properties:{storyNode:cc.Node,nextButtonNode:cc.Node,storyFrames:[cc.SpriteFrame]},onNext:function(){var e=this.storyNode.getComponent(cc.Sprite);this._storyFrameIndex>6?this._storyFrameIndex=this._storyFrameIndex:this._storyFrameIndex=this._storyFrameIndex+1,e.spriteFrame=this.storyFrames[this._storyFrameIndex],this._storyFrameIndex>=6&&(this.nextButtonNode.active=!1,this._storyFrameIndex=0)},onload:function(){this._storyFrameIndex=0,this.storyNode.getComponent(cc.Sprite).spriteFrame=this.storyFrames[this._storyFrameIndex],this.nextButtonNode.active=!0}}),cc._RF.pop()},{}],MusicLoop:[function(e,t,n){"use strict";cc._RF.push(t,"87407BkzlRH0p7POYV6E84Y","MusicLoop"),cc.Class({extends:cc.Component,properties:{BackGrounpBGM:cc.AudioSource},onLoad:function(){this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play()}}),cc._RF.pop()},{}],PopupWindow:[function(e,t,n){"use strict";cc._RF.push(t,"be07ady7wRFWpP+zOcFY/xn","PopupWindow"),cc.Class({extends:cc.Component,ctor:function(){},properties:{},Show_Window:function(){this.node.active=!0},Hide_Window:function(){this.node.active=!1},Next_Click:function(){},Exit_Click:function(){this.Hide_Window()}}),cc._RF.pop()},{}],SceneFacade:[function(e,t,n){"use strict";cc._RF.push(t,"d92be3+8lBCKZdLU76R9P66","SceneFacade"),cc.Class({extends:cc.Component,properties:{},start:function(){},loadScene:function(e,t){cc.director.loadScene(t)}}),cc._RF.pop()},{}],SpriteIndex:[function(e,t,n){"use strict";cc._RF.push(t,"24dacw8QS1Kpr0ZBSQEQOkx","SpriteIndex"),cc.Class({extends:cc.Component,properties:{_index:20,spr:{default:[],type:cc.SpriteFrame},bar:{get:function(){return this._index},set:function(e){e<0||(this._index=e%spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])}}},onLoad:function(){var e=this;this.schedule(function(){e._index++},3)},onTouchChange:function(){this._index++}}),cc._RF.pop()},{}],sss:[function(e,t,n){"use strict";cc._RF.push(t,"f3e3diG0XRNooiikC+9LuyF","sss");var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=this&&this.__decorate||function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,c=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spr=[],t._index=0,t}return i(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){e<0||(this._index=e%this.spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.schedule(function(){e.index++},3)},t.prototype.onTouchChange=function(){this.index++},a([c(cc.SpriteFrame)],t.prototype,"spr",void 0),a([c],t.prototype,"_index",void 0),a([c],t.prototype,"index",null),t=a([r],t)}(cc.Component);n.default=s,cc._RF.pop()},{}]},{},["Battle","ChangeStoryPic","MusicLoop","PopupWindow","SceneFacade","SpriteIndex","sss"]);