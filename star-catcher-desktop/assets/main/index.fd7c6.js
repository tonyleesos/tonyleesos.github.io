window.__require=function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var c=o.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!s&&d)return d(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+o+"'")}o=c}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){return r(t[o][1][e]||e)},h,h.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<i.length;o++)r(i[o]);return r}({Battle:[function(e,t,n){"use strict";cc._RF.push(t,"f11ccuzoOVLdJ+t8nnV4YAf","Battle");var i=cc.Class({name:"Card",properties:{id:cc.Integer,type:cc.Integer,level:cc.Integer,value:cc.Integer,realValue:{get:function(){return this.value*this.level}}}});cc.Class({extends:cc.Component,properties:{cardFrames:[cc.SpriteFrame],enemyBlood:{default:100,type:cc.Integer},playerDefense:{default:0,type:cc.Integer},playerBlood:{default:50,type:cc.Integer},enemyBloodBar:cc.ProgressBar,playerBloodBar:cc.ProgressBar,activeCards:[cc.Button],handCards:[cc.Button],handCardBlockInputEvents:cc.Node,hitPicture:cc.Sprite,hitedPicture:cc.Sprite,WinPopupWindow:cc.Sprite,LosePopupWindow:cc.Sprite,BackGrounpBGM:cc.AudioSource,HealAnimation:cc.Animation,DefenseAnimation:cc.Animation,DefenseIcon:cc.Sprite,AttackView:cc.Sprite,DefenseView:cc.Sprite,HealView:cc.Sprite,AttackBgm:cc.AudioClip,DefenseBgm:cc.AudioClip,HealBgm:cc.AudioClip,HitedBgm:cc.AudioClip},onLoad:function(){var e=this;this.handCardBlockInputEvents.zIndex=999,this._activeCardObjects=[],this._handCardObjects=[],this._currentEnemyBlood=this.enemyBlood,this._currentPlayerBlood=this.playerBlood,this._disableHandCardCount=0,this._isDragging=!1,this.handCards.forEach(function(t,n){e.bindHandCardEvents(t,n)}.bind(this)),this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){var e=this;this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play();for(var t=0;t<7;t++)this._handCardObjects.push(this.getRandomCard());this.refresh(),cc.tween(this.node).delay(1).call(function(){e.combineHandCards(!0)}).start()},refreshActiveCards:function(){for(var e=0;e<3;e++)if(this._activeCardObjects[e]){var t=0==this._activeCardObjects[e].type?0:3*(this._activeCardObjects[e].type-1)+this._activeCardObjects[e].level;this.activeCards[e]._sprite.spriteFrame=this.cardFrames[t]}else this.activeCards[e]._sprite.spriteFrame=null},refreshHandCards:function(){for(var e=0;e<7;e++)if(this._handCardObjects[e]){var t=0==this._handCardObjects[e].type?0:3*(this._handCardObjects[e].type-1)+this._handCardObjects[e].level;this.handCards[e]._sprite.spriteFrame=this.cardFrames[t]}else this.handCards[e]._sprite.spriteFrame=null},refreshBlood:function(){this.enemyBloodBar.progress=this._currentEnemyBlood/this.enemyBlood,this.playerBloodBar.progress=this._currentPlayerBlood/this.playerBlood},refresh:function(){this.refreshActiveCards(),this.refreshHandCards(),this.refreshBlood()},getRandom:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getRandomCard:function(){var e=this.getRandom(1,3),t=new i;switch(t.id=e,t.level=1,e){case 1:t.type=1,t.value=10;break;case 2:t.type=2,t.value=2;break;case 3:t.type=3,t.value=2}return t},getMoveCard:function(){var e=new i;return e.id=0,e.level=0,e.type=0,e.value=0,e},combineHandCards:function(e){var t,n=this;do{var r=null,a=[];t=this._handCardObjects.length;for(var o=0;o<this._handCardObjects.length;o++){var s=!1;if(r){var c=new i;c.id=r.id,c.type=r.type,c.value=r.value,r.type==this._handCardObjects[o].type&&r.level==this._handCardObjects[o].level&&r.level<3?(c.level=r.level+1,s=!0):c.level=r.level,a.push(c)}r=s?null:this._handCardObjects[o],o==this._handCardObjects.length-1&&r&&a.push(r)}this._handCardObjects=a}while(t!=this._handCardObjects.length);this.refreshHandCards(),e&&this._handCardObjects.length<7&&cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.drawCard()}).call(function(){n.enableHandCards()}).start()},drawCard:function(){for(var e=this,t=0;t<7-this._handCardObjects.length;t++)this._handCardObjects.push(this.getRandomCard());this.refreshHandCards(),cc.tween(this.node).call(function(){e.disableHandCards()}).delay(.5).call(function(){e.combineHandCards(!0)}).call(function(){e.enableHandCards()}).start()},onHandCardClick:function(e,t){var n=this;!this._isDragging&&this._activeCardObjects.length<3?(this._activeCardObjects.push(this._handCardObjects.splice(t,1)[0]),this.refresh(),this.combineHandCards(!1),3==this._activeCardObjects.length&&cc.tween(this.node).delay(1).call(function(){n.onCardAction()}).start()):this._isDragging=!1},onCardMoved:function(e,t){for(var n=this,i=this._handCardObjects.length,r=0;r<this._handCardObjects.length;r++)if(this.handCards[r].node.x+62>=t&&this.handCards[r].node.x<t){i=r;break}if(e!=i&&e!=i-1){var a=this._handCardObjects[e];if(i>e){for(r=e;r<i-1;r++)this._handCardObjects[r]=this._handCardObjects[r+1];this._handCardObjects[i-1]=a}else{for(r=e;r>i;r--)this._handCardObjects[r]=this._handCardObjects[r-1];this._handCardObjects[i]=a}this._activeCardObjects.push(this.getMoveCard()),this.refresh();var o=cc.tween(this.node).call(function(){n.disableHandCards()}).delay(.5).call(function(){n.combineHandCards(!1)});3==this._activeCardObjects.length&&(o=o.delay(1).call(function(){n.onCardAction()})),o.call(function(){n.enableHandCards()}).start()}},onCardAction:function(){for(var e=this,t=cc.tween(this.node).call(function(){e.disableHandCards()}),n=0;n<this._activeCardObjects.length;n++)t=t.call(function(){var n=e._activeCardObjects.splice(0,1)[0];switch(n.type){case 1:e.attack(n.realValue,t);break;case 2:e.defense(n.realValue);break;case 3:e.heal(n.realValue)}e.refreshActiveCards(),e.refreshBlood()}).delay(1).call(function(){e.initialRound()});t=t.call(function(){e.playerDefense<=10&&(e._currentPlayerBlood-=10-e.playerDefense),cc.audioEngine.play(e.HitedBgm,!1,.5),e.hitedPicture.node.active=!0,e.playerDefense=0,e._currentPlayerBlood<=0&&(e.showLosePopup(),t.stop()),e.refresh()}).delay(1).call(function(){e.hitedPicture.node.active=!1,e.drawCard()}).call(function(){e.enableHandCards()}).start()},initialRound:function(){this.hitPicture.node.active=!1,this.AttackView.node.active=!1,this.DefenseView.node.active=!1,this.DefenseIcon.node.active=!1,this.HealView.node.active=!1,this.HealAnimation.node.active=!1},bindHandCardEvents:function(e,t){var n,i=this,r=!1;e.node.on(cc.Node.EventType.TOUCH_START,function(t){r=!0,n=e.node.x,e.node.zIndex=100}),e.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(r){var n=t.getDelta(),a=e.node.x+n.x;a>=195&&(a=195),a<=-195&&(a=-195),e.node.x=a,i._isDragging=!0}}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_END,function(a){var o=e.node.x;r=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,o)}.bind(this)),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(a){var o=e.node.x;r=!1,e.node.x=n,e.node.zIndex=0,i._isDragging&&i.onCardMoved(t,o)}.bind(this))},enableHandCards:function(){this._disableHandCardCount--,this._disableHandCardCount<=0&&(this._disableHandCardCount=0,this.handCardBlockInputEvents.active=!1)},disableHandCards:function(){this._disableHandCardCount++,this.handCardBlockInputEvents.active=!0},attack:function(e,t){if(this._currentEnemyBlood-=e,cc.audioEngine.play(this.AttackBgm,!1,.5),this._currentEnemyBlood<=0)return this.showWinPopup(),void t.stop();this.AttackView.node.active=!0,this.hitPicture.node.active=!0},defense:function(e){this.playerDefense+=e,this.DefenseView.node.active=!0,this.DefenseIcon.node.active=!0,this.DefenseAnimation.play(),cc.audioEngine.play(this.DefenseBgm,!1,.5)},heal:function(e){this._currentPlayerBlood+=e,this.HealView.node.active=!0,this.HealAnimation.node.active=!0,this.HealAnimation.play(),cc.audioEngine.play(this.HealBgm,!1,.5)},showWinPopup:function(){this.WinPopupWindow.node.active=!0,cc.tween(this.WinPopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()},showLosePopup:function(){this.LosePopupWindow.node.active=!0,cc.tween(this.LosePopupWindow.node).to(.5,{scale:1,opacity:255},{easing:"quartInOut"}).start()}}),cc._RF.pop()},{}],ChangeStoryPic:[function(e,t,n){"use strict";cc._RF.push(t,"c08d23yc4NGxLCETjdFsDyY","ChangeStoryPic"),cc.Class({extends:cc.Component,ctor:function(){this._storyFrameIndex=1},properties:{storyNode:cc.Node,nextButtonNode:cc.Node,storyFrames:[cc.SpriteFrame]},onNext:function(){var e=this.storyNode.getComponent(cc.Sprite);this._storyFrameIndex>6?this._storyFrameIndex=this._storyFrameIndex:this._storyFrameIndex=this._storyFrameIndex+1,e.spriteFrame=this.storyFrames[this._storyFrameIndex],this._storyFrameIndex>=6&&(this.nextButtonNode.active=!1,this._storyFrameIndex=0)},onload:function(){this._storyFrameIndex=0,this.storyNode.getComponent(cc.Sprite).spriteFrame=this.storyFrames[this._storyFrameIndex],this.nextButtonNode.active=!0}}),cc._RF.pop()},{}],LoadingProgressBar:[function(e,t,n){"use strict";cc._RF.push(t,"8cbcdNbt1pEEZeD2QZ8+er8","LoadingProgressBar"),cc.Class({extends:cc.Component,properties:{progress:cc.ProgressBar,text:cc.Label},start:function(){var e=this;this.text.string="0%",this.progress.progress=0,cc.director.preloadScene("battle",function(t,n,i){var r=t/n;e.progress.progress=r,e.text.string=parseInt(100*r)+"%",console.log(e.text.string)},function(){cc.director.loadScene("battle")})}}),cc._RF.pop()},{}],MusicLoop:[function(e,t,n){"use strict";cc._RF.push(t,"87407BkzlRH0p7POYV6E84Y","MusicLoop"),cc.Class({extends:cc.Component,properties:{BackGrounpBGM:cc.AudioSource},onLoad:function(){this.audio2=this.node.getChildByName("BackGrounpBGM").getComponent(cc.AudioSource)},start:function(){this.audio2.loop=!0,this.audio2.mute=!1,this.audio2.play()}}),cc._RF.pop()},{}],PopupWindow:[function(e,t,n){"use strict";cc._RF.push(t,"be07ady7wRFWpP+zOcFY/xn","PopupWindow"),cc.Class({extends:cc.Component,ctor:function(){},properties:{},Show_Window:function(){this.node.active=!0},Hide_Window:function(){this.node.active=!1},Next_Click:function(){},Exit_Click:function(){this.Hide_Window()}}),cc._RF.pop()},{}],SceneFacade:[function(e,t,n){"use strict";cc._RF.push(t,"d92be3+8lBCKZdLU76R9P66","SceneFacade"),cc.Class({extends:cc.Component,properties:{},start:function(){},loadScene:function(e,t){cc.director.loadScene(t)}}),cc._RF.pop()},{}],SpriteIndex:[function(e,t,n){"use strict";cc._RF.push(t,"24dacw8QS1Kpr0ZBSQEQOkx","SpriteIndex"),cc.Class({extends:cc.Component,properties:{_index:20,spr:{default:[],type:cc.SpriteFrame},bar:{get:function(){return this._index},set:function(e){e<0||(this._index=e%spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])}}},onLoad:function(){var e=this;this.schedule(function(){e._index++},3)},onTouchChange:function(){this._index++}}),cc._RF.pop()},{}],sss:[function(e,t,n){"use strict";cc._RF.push(t,"f3e3diG0XRNooiikC+9LuyF","sss");var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__decorate||function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,o=a.ccclass,s=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spr=[],t._index=0,t}return i(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){e<0||(this._index=e%this.spr.length,this.node.getComponent(cc.Sprite).spriteFrame=this.spr[this._index])},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.schedule(function(){e.index++},3)},t.prototype.onTouchChange=function(){this.index++},r([s(cc.SpriteFrame)],t.prototype,"spr",void 0),r([s],t.prototype,"_index",void 0),r([s],t.prototype,"index",null),t=r([o],t)}(cc.Component);n.default=c,cc._RF.pop()},{}]},{},["Battle","ChangeStoryPic","LoadingProgressBar","MusicLoop","PopupWindow","SceneFacade","SpriteIndex","sss"]);